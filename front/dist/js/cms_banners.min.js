function Banners(){}Banners.prototype.addbanners=function(){var e=this;$(".cms-header .button button").click(function(){if($(".banner-item").length<6){var n=template("add-banners"),a=$(".row");a.prepend(n);var t=a.find(".loop-img:first");e.addimg(t),e.remveBanners(t),e.saveBtnEvent(t)}else xfzalert.alertErrorToast("已经6张轮播图了，无法在添加")})},Banners.prototype.addimg=function(n){var t=n.find("img");t.click(function(){var n=$(this).parent().siblings("#addimg");n.click(),n.change(function(){var n=this.files[0],a=new FormData;a.append("file",n),$.post({url:"/cms/upload/",data:a,processData:!1,contentType:!1,success:function(n){if(200===n.code){var a=n.data.url;t.attr("src",a)}}})})})},Banners.prototype.remveBanners=function(a){a.parent().siblings().find(".banner-close").click(function(){var n=a.parent().parent().parent().parent().parent().attr("data-banner-id");xfzalert.alertConfirm({title:"您确定要删除吗?",confirmCallback:function(){a.parent().parent().parent().parent().parent().remove(),n&&xfzajax.post({url:"/cms/banner_delete/",data:{banner_id:n}})}})})},Banners.prototype.saveBtnEvent=function(r){var n=r.parent().parent().siblings(".box-footer").find("#save_btn"),i=r.parent().parent().parent().parent().parent().attr("data-banner-id"),s="";s=i?"/cms/banner_edit/":"/cms/add_banner/",n.click(function(n){n.preventDefault();var a=r.find("img").attr("src"),t=r.siblings(".loop-content").find('input[name="link-addr"]').val(),e=r.siblings(".loop-content").find('input[name="priority"]').val();xfzajax.post({url:s,data:{image_url:a,link_to:t,priority:e,pk:i},success:function(n){if(200===n.code){if(i)console.log(i),xfzalert.alertSuccessToast("修改成功");else{var a=n.data.banner_id;xfzalert.alertSuccessToast("保存成功"),r.parent().parent().parent().parent().parent().attr("data-banner-id",a)}r.parent().siblings().find(".iteml").text("优先级:"+e)}else xfzalert.alertSuccessToast("保存成功")}})})},Banners.prototype.loadData=function(){var r=this;xfzajax.get({url:"/cms/banner_list/",success:function(n){if(200===n.code){var a=n.data;for(i=0;i<a.length;i++){banner=a[i],tpl=template("add-banners",{banner:banner});var t=$(".row");t.append(tpl);var e=t.find(".loop-img:last");r.saveBtnEvent(e),r.remveBanners(e),r.addimg(e)}}}})},Banners.prototype.run=function(){this.addbanners(),this.loadData()},$(function(){(new Banners).run()});